/*!
 ***************************************************************************************
 *
 *  Copyright ? 2017-2018 yifneg. All Rights Reserved.
 *
 * \file      main.cpp
 * \author    yifeng
 * \version   1.0
 * \date      2023年3月11日
 * \brief     主程序
 *
 *--------------------------------------------------------------------------------------
 * \attention
 *
 *
 ***************************************************************************************
 */

/*****************************************************************************************
 change history: 
    1.date  : 2023年3月11日
      author: yifeng
      change: create file

*****************************************************************************************/


/*========================================================================================
                                 本源程序包括的头文件                                     
建议：包含本项目的文件使用 #include "文件名.扩展名"，                                   
      包含系统库的文件使用 #include <文件名.扩展名> 。                                    
========================================================================================*/
#include "Main.h"
#include "TimerDeal.h"
#include "UartDevice.h"
#include "UsartDeal.h"
#include "WiredNetDeal.h"
#include "NetDataDeal.h"
#include "NtpDeal.h"
#include "EventDeal.h"
#include "KeyDeal.h"
#include "PlayPcm.h"
#include "EepromDeal.h"

/*=======================================================================================
下面这三条指令是用于区分编译系统为 C++ 或 C 的预处理指令。                               
"__cplusplus" 为 C++ 预处理器名字，这三条指令表明接在其下面的那些指令为 C 程序特征.      
=======================================================================================*/
#ifdef __cplusplus
extern "C" {
#endif


/*=======================================================================================
                            本源程序文件内部使用的字符化常数定义                         
=======================================================================================*/
/*---------------------------------------------------------------------------------------
的字符化常数定义：
----------------------------------------------------------------------------------------*/


/*=======================================================================================
                             本源程序文件内部使用的函数原型声明                          
=======================================================================================*/


/*=======================================================================================
                       本源程序文件内部使用的局部常量、字符化常数定义                    
=======================================================================================*/
/*---------------------------------------------------------------------------------------
的局部常量、字符化常数定义：
---------------------------------------------------------------------------------------*/


/*=======================================================================================
                                         全局常量定义                                    
=======================================================================================*/
/*---------------------------------------------------------------------------------------
的全局常量定义：
---------------------------------------------------------------------------------------*/


/*=======================================================================================
                                         全局变量定义                                    
=======================================================================================*/
/*---------------------------------------------------------------------------------------
的全局变量定义：
---------------------------------------------------------------------------------------*/
SysRunStru gstvSysRun;


/*=======================================================================================
                             本源程序文件内部使用的局部变量定义                          
=======================================================================================*/




/*
*****************************************************************************************
                            　       程序指令代码清单
*****************************************************************************************
*/


static void sigterm_handle(int signal)
{
  fprintf(stderr, "signal %d\n", signal);
  
  gstvSysRun.quit = true;
}

/*!
 * \fn     main
 * \brief  主程序
 *          
 * \param  [in] int argc       #
 * \param  [in] char *argv[]   #
 * 
 * \retval int
 */
int main(int argc, char *argv[])
{
  printf("main start!\n");

  /* 信号机制 */
  signal(SIGINT, sigterm_handle);
  
  /* 初始化 */
  memset(&gstvSysRun, 0, sizeof(SysRunStru));

  EventDeal_Init();

    /* 创建任务 */
  Start_TimerDeal_Monitor_Thread();         // 定时器

  Start_UsartDeal_Monitor_Thread();         // 串口
  
  Start_DeviceUartDeal_Monitor_Thread();    // 设备烧录

  Start_WiredNetDeal_Monitor_Thread();      // 有线网络检测

  Start_NetDataDeal_Monitor_Thread();       // 协议数据处理

  Start_NtpDeal_Monitor_Thread();           // Ntp服务处理

  Start_KeyDeal_Monitor_Thread();           // 按键处理

  Start_PlayPcmDeal_Monitor_Thread();       // 播放PCM

  while(!gstvSysRun.quit)
  {
    sleep(5);
  }

  gstvSysRun.quit = false;

  printf("main end!\n");

  return 0;
}





/*=======================================================================================
下面这三条指令是用于与上面三条区分编译系统为 C++ 或 C 的预处理指令相对应。用于指定
 extern "C" 链接指示符作用域，此处的"}"与上面的"{"相对应，为链接指示符作用结束符。
=======================================================================================*/
#ifdef __cplusplus
}
#endif


/*
*****************************************************************************************
                                 本Ｃ语言源程序文件到此结束
*****************************************************************************************
*/
